## Redcarpet (**Re**combination **D**etection using **C**omparative **A**nalysis of **R**egional **P**atterns of **E**xact Match **T**argets)

Redcarpet is a alignment-free recombination detection tool that utilizes genomic database distributions of exact protein matches. Redcarpet builds on the [WhatsGNU](https://github.com/ahmedmagds/WhatsGNU) method, which uses exact matching for identifying proteomic novelty.

Redcarpet takes in a single query genome, and for each encoded protein, determines the set of genomes in a database that contain an exact protein sequence match. It then computes the Jaccard similarity coefficient between genome sets for all pairwise protein comparisons in the genome.


---
### Getting the Input File for Redcarpet

WhatsGNU must first be run in order to get the hits file that will serve as the input for Redcarpet. To install WhatsGNU, see [here](https://github.com/ahmedmagds/WhatsGNU?tab=readme-ov-file#installation).

Using a hashed database:

```WhatsGNU_main_hashes.py -d $database_path -csv $file.csv -i --hash_values -o $output_directory query_faa/```

```
whatsgnu_output/
├── GCF_000005845.2_prtn_id_hashes.csv
├── GCF_000005845.2_WhatsGNU_hits.txt
├── GCF_000005845.2_WhatsGNU_report.txt
└── WhatsGNU_20250108_115433.log
```

### Running Redcarpet

To run Redcarpet, use the following command:

```python3 Redcarpet.py $WhatsGNU_hits.txt```

```
usage: Redcarpet.py [-h] [-v] [-bk BOTTOM_K] [--hash_file HASH_FILE] ids_hits_file

Alignment-Free Recombination Detector

positional arguments:
  ids_hits_file         ids_hits_file from WhatsGNU -i option

options:
  -h, --help            show this help message and exit
  -v, --version         print version and exit
  -bk BOTTOM_K, --bottom_k BOTTOM_K
                        bottom-k cutoff for hits (default: all hits are used)
  --hash_file HASH_FILE
                        ids hash file for a WhatsGNU database
```
[Discuss what is meant by bottom_k option]

### Changepoint Analysis

Once the RedCarpet Report has been generated by Redcarpet, you can start on the changepoint analysis step. To execute this step, use the following command:

```python3 CarpetCleanChangepoints.py -i $input_report -o $output_directory```

#### Options:

- `-i` : Path to the heatmap file generated by Redcarpet.
- `-o` : Directory to store the refined outputs.

**Example Command:**

`python3 CarpetCleanChangepoints.py -i Redcarpet_report.txt -o refined_results/`

The output will have different regions of the genome with the changepoints identified. Additionally, information about which regions are similar will be provided.

### Additional Resources Available

*Already completed heatmaps and reports for all S.aureus and K.pneumoniae*
